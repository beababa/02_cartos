---
title: "ril : pb extraction fichier"
author: "B. Maranget"
date: "27/02/2023"
output: 
  html_document: 
    number_sections: yes
    toc: yes
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
# Passer la valeur suivante à TRUE pour reproduire les extractions.
knitr::opts_chunk$set(eval = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```


# Objet

le RIL a un champs qui commentaire qui pose un pb de décalage poru les champs X, Y dans QGIS
(pas dans libre office, ni excel)

dans RORCAL, il s'agit de 99 EA, le fichier d'export n'en fait que 91. TODO

faire également l'intersection.

# Environnement


## Librairies


```{r}
library(sf)
library(mapsf)
```


## Chemins


```{r}
chemin <- "C:/Users/bmaranget/Documents/03_SIG/03_03_Data/11_RIL/"
chemin2 <- "C:/Users/bmaranget/Documents/03_SIG/03_03_Data/03_SOCLE/"
```



# données



```{r}
ril <- read.csv2("../data/rilFevrier2023.csv", fileEncoding = "UTF-8", dec =".", skip = 1)
str(ril)
# spatialisation
ril <- st_as_sf(ril, coords = c("x", "y"), crs = 2154 )
st_layers("../data/ril.gpkg")
st_write(ril, "../data/ril.gpkg", "rilFev2023", delete_layer = T)

```

les zones de sortie

elles sont dessinées sous qgis, puis l'intersection est faite sous R


```{r}
zone <- st_read("../data/ril.gpkg", "zonesDeSortie")
ril <- st_intersection(ril, zone)
ril <- ril [, c("numero", "repetition", "complement", "type_voie", "libelle", "nombre_logements", "numero_permis", "commentaire", "zone")]
st_write(ril, "../data/ril.gpkg", "rilFev2023", delete_layer = T)
str(ril)

write.csv(st_drop_geometry(ril),"../data/ril.csv", fileEncoding = "UTF-8")
```

nb de points pour chaque sortie

```{r}
agg <- aggregate(ril [, "zone"], by = list(ril$zone), length)
# verif
sum(agg$zone)
zone <- merge (st_drop_geometry(agg), zone, by.x = "Group.1", by.y = "zone")
st_write(zone, "../data/ril.gpkg", "zonesDeSortie", delete_layer = T)
```


cheminement

http://map.vroom-project.org/?

```{r}
ril <- read.csv("../data/ril.csv", fileEncoding = "UTF-8")
rilRoutage <- cbind(ril [, c("numero", "type_voie", "libelle")])

rilRoutage <- sapply(rilRoutage, paste)
sapply(rilRoutage, paste)

write.csv(rilRoutage, "../data/rilRoutage.csv", fileEncoding = "UTF-8")
```






